<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title></title>
                  <script type="text/javascript" src="http://d3js.org/d3.v3.js"></script>
		<style type="text/css">
                    .axis path,
                    .axis line {
                        fill: none;
                        stroke: black;
                        shape-rendering: crispEdges;
                    }
                    .axis text {
                        font-family: sans-serif;
                        font-size: 11px;
                    }
                    .corline {
                        stroke:rgb(0,0,255);
                        stroke-width:2;
                    }
                </style>
	</head>
	<body>
		<script type="text/javascript">
			//Width and height
                        var width   = 900,
                            height  = 600;
                            padding = 30;
                            
                        var x_scale = d3.scale.linear()
                                              /*.domain([10, d3.max(data, function(d) { return d.lonest; })])*/
                                              .domain([10, 35])
                                              .range([padding, width-padding]);
                        var y_scale = d3.scale.linear()
                                              /*.domain([10, d3.max(data, function(d) { return d.latest; })])*/
                                              .domain([25, 42])
                                              .range([height-padding, padding]);

                        //Define X axis
                        var xAxis = d3.svg.axis()
                                          .scale(x_scale)
                                          .orient("bottom")
                                          .ticks(2.5);
                        //Define Y axis
                        var yAxis = d3.svg.axis()
                                          .scale(y_scale)
                                          .orient("left")
                                          .ticks(2.5);

                        // Load dataset from csv.
                        d3.csv("addneq.csv", function(error, adn_data) {
                            if (error) {
                                console.log(error)
                            } else {
                                console.log(adn_data);
                                //cvs_ds = adn_data;
                            }

                            // Create svg in DOM
                            var svg = d3.select("body")
                                        .append("svg")
                                        .attr("width", width)
                                        .attr("height", height);
                            // Herein, a series of ellipses 
                            var ellipses = svg.selectAll("ellipse")
                                             .data(adn_data)
                                             .enter()
                                             .append("ellipse");
                            //Create Y axis
                            svg.append("g")
                               .attr("class", "axis")
                               .attr("transform", "translate(" + padding + ",0)")
                               .call(yAxis);

                            //Create X axis
                            svg.append("g")
                               .attr("class", "axis")
                               .attr("transform", "translate(0," + (height-padding) + ")")
                               .call(xAxis);

                            // ... with data-defined attributes
                            
                            ellipses.attr("cx", function(d, i) {
                                        return x_scale( d.lonest );
                                    })
                                    .attr("cy", function(d) {
                                        return y_scale( d.latest );
                                    })
                                    .attr("rx", function(d) {
                                        return d.lonrms*10000;
                                    })
                                    .attr("ry", function(d) {
                                        return d.latrms*10000;
                                    })
                                    .attr("fill", function(d) { 
                                        if (d.adj=="HELMR")
                                            return "red";
                                        else
                                            return "yellow";
                                    })
                                    .attr("stroke", "orange")
                                    .attr("stroke-width", function(d) {
                                        return 2;
                                    });
                            
                            
                            svg.selectAll("text")
                               .data(adn_data)
                               .enter()
                               .append("text")
                               .text(function(d) { return d.name; })
                               .attr("text-anchor", "middle")
                               .attr("x", function(d) { return x_scale(d.lonest) })
                               .attr("y", function(d) { return y_scale(d.latest) })
                               .attr("font-size", "11px")
                               .attr("fill", "black");
                            
                            svg.selectAll("polyline")
                                .data(adn_data)
                                .enter()
                                .append("polyline")
                                .attr("points", function(d) {
                                    var p1 = [x_scale(d.lonest), y_scale(d.latest)];
                                    var p2 = [x_scale(d.lonest) + 1000.0*d.east, y_scale(d.latest)];
                                    var p3 = [x_scale(d.lonest), y_scale(d.latest)];
                                    var p4 = [x_scale(d.lonest), y_scale(d.latest) + 1000.0*d.north];
                                    console.log([p1, p2, p3, p4])
                                    return p1 + " " + p2 + " " + p3 + " " + p4;
                                })
                                .attr("fill", "none")
                                .attr("stroke", "black")
                                .attr("stroke-width", "2");

                            /*
                            svg.selectAll("line")
                                .data(adn_data)
                                .enter()
                                .append("line")
                                .attr("x1", function(d){ return x_scale(d.lonest);})
                                .attr("y1", function(d){ return y_scale(d.latest);})
                                .attr("x2", function(d){ return x_scale(d.lonest) + 1000.0*d.east;})
                                .attr("y2", function(d){ return y_scale(d.latest);})
                                .attr("class", "corline");
                            svg.selectAll("line")
                                .data(adn_data)
                                .enter()
                                .append("line")
                                .attr("x1", function(d){ return x_scale(d.lonest);})
                                .attr("y1", function(d){ return y_scale(d.latest);})
                                .attr("x2", function(d){ return x_scale(d.lonest);})
                                .attr("y2", function(d){ return y_scale(d.latest) + 1000.0*d.north;})
                                .attr("class", "corline");
                            */


                        });
		</script>
	</body>
</html>
